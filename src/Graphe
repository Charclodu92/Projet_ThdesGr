import java.io.File;
import java.io.FileNotFoundException;
import java.util.*;

class Arete {
    String nomRue;
    String source, destination;
    int poids;

    public Arete(String nom, String s, String d, int p) {
        this.nomRue = nom;
        this.source = s;
        this.destination = d;
        this.poids = p;
    }
}

class resultat_chemin {
    int distance;
    List<String> chemin;

    public resultat_chemin(int d, List<String> c) {
        this.distance = d;
        this.chemin = c;
    }
}

public class Graphe {
    private Map<String, List<Arete>> adjacence = new HashMap<>();

    private List<Arete> toutesLesAretes = new ArrayList<>();

    public void chargerDepuisFichier(String cheminFichier) {
        adjacence.clear();
        toutesLesAretes.clear();
        try {
            File file = new File(cheminFichier);
            Scanner scanner = new Scanner(file);

            while (scanner.hasNextLine()) {
                String ligne = scanner.nextLine().trim();
                if (ligne.isEmpty()) continue;


                String[] parts = ligne.split(";");


                if (parts.length >= 4) {
                    String nom = parts[0].trim();
                    String u = parts[1].trim();
                    String v = parts[2].trim();
                    try {
                        int poids = Integer.parseInt(parts[3].trim());
                        ajouterArete(nom, u, v, poids);
                    } catch (NumberFormatException e) {
                        System.out.println("Erreur de poids sur la ligne : " + ligne);
                    }
                }
            }
            scanner.close();
            System.out.println("[SUCCES] Graphe charg√© (" + toutesLesAretes.size() + " segments).");
        } catch (FileNotFoundException e) {
            System.out.println("[ERREUR] Fichier introuvable : " + cheminFichier);
        }
    }

    public void ajouterArete(String nom, String u, String v, int poids) {
        adjacence.putIfAbsent(u, new ArrayList<>());
        adjacence.putIfAbsent(v, new ArrayList<>());

        Arete a = new Arete(nom, u, v, poids);
        adjacence.get(u).add(a);
        toutesLesAretes.add(a);
    }

    public Arete getAreteParNom(String nomRecherche) {
        for (Arete a : toutesLesAretes) {
            if (a.nomRue.equalsIgnoreCase(nomRecherche)) {
                return a;
            }
        }
        return null;
    }

    public Arete getAreteParExtremites(String u, String v) {
        if (adjacence.containsKey(u)) {
            for (Arete a : adjacence.get(u)) {
                if (a.destination.equalsIgnoreCase(v)) return a;
            }
        }
        return null;
    }

    public resultat_chemin plusCourtChemin(String depart, String arrivee) {
        if (!adjacence.containsKey(depart) || !adjacence.containsKey(arrivee))
            return new resultat_chemin(-1, new ArrayList<>());

        Map<String, Integer> distances = new HashMap<>();
        Map<String, String> predecesseurs = new HashMap<>();
        PriorityQueue<String> file = new PriorityQueue<>(Comparator.comparingInt(distances::get));

        for (String n : adjacence.keySet()) distances.put(n, Integer.MAX_VALUE);
        distances.put(depart, 0);
        file.add(depart);

        while (!file.isEmpty()) {
            String u = file.poll();
            if (u.equals(arrivee)) break;
            if (distances.get(u) == Integer.MAX_VALUE) break;

            if (adjacence.containsKey(u)) {
                for (Arete voisin : adjacence.get(u)) {
                    int newDist = distances.get(u) + voisin.poids;
                    if (newDist < distances.get(voisin.destination)) {
                        distances.put(voisin.destination, newDist);
                        predecesseurs.put(voisin.destination, u);
                        file.add(voisin.destination);
                    }
                }
            }
        }

        if (distances.get(arrivee) == Integer.MAX_VALUE) return new resultat_chemin(-1, new ArrayList<>());

        LinkedList<String> b = new LinkedList<>();
        String a = arrivee;
        while (a != null) {
            b.addFirst(a);
            a = predecesseurs.get(a);
        }
        return new resultat_chemin(distances.get(arrivee), b);
    }
}
